!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("webrtcDC",[],n):"object"==typeof exports?exports.webrtcDC=n():e.webrtcDC=n()}(window,(function(){return function(e){var n={};function t(a){if(n[a])return n[a].exports;var o=n[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=n,t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(a,o,function(n){return e[n]}.bind(null,o));return a},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=1)}([function(e,n){var t={default:this,call:function(e,n,t){var a="";"function"==typeof n&&(t=n,n={});var o={data:void 0===n?null:n};if("function"==typeof t){var s="dscb"+window.dscb++;window[s]=t,o._dscbstub=s}return o=JSON.stringify(o),window._dsbridge?a=_dsbridge.call(e,o):(window._dswk||-1!=navigator.userAgent.indexOf("_dsbridge"))&&(a=prompt("_dsbridge="+e,o)),JSON.parse(a||"{}").data},register:function(e,n,a){var o=a?window._dsaf:window._dsf;window._dsInit||(window._dsInit=!0,setTimeout((function(){t.call("_dsb.dsinit")}),0)),"object"==typeof n?o._obs[e]=n:o[e]=n},registerAsyn:function(e,n){this.register(e,n,!0)},hasNativeMethod:function(e,n){return this.call("_dsb.hasNativeMethod",{name:e,type:n||"all"})},disableJavascriptDialogBlock:function(e){this.call("_dsb.disableJavascriptDialogBlock",{disable:!1!==e})}};!function(){if(!window._dsf){var e={_dsf:{_obs:{}},_dsaf:{_obs:{}},dscb:0,dsBridge:t,close:function(){t.call("_dsb.closePage")},_handleMessageFromNative:function(e){var n=JSON.parse(e.data),a={id:e.callbackId,complete:!0},o=this._dsf[e.method],s=this._dsaf[e.method],i=function(e,o){a.data=e.apply(o,n),t.call("_dsb.returnValue",a)},l=function(e,o){n.push((function(e,n){a.data=e,a.complete=!1!==n,t.call("_dsb.returnValue",a)})),e.apply(o,n)};if(o)i(o,this._dsf);else if(s)l(s,this._dsaf);else{var r=e.method.split(".");if(r.length<2)return;var c=r.pop(),d=r.join("."),u=this._dsf._obs,f=u[d]||{},h=f[c];if(h&&"function"==typeof h)return void i(h,f);if((h=(f=(u=this._dsaf._obs)[d]||{})[c])&&"function"==typeof h)return void l(h,f)}}};for(var n in e)window[n]=e[n];t.register("_hasJavascriptMethod",(function(e,n){var t=e.split(".");if(t.length<2)return!(!_dsf[t]&&!_dsaf[t]);e=t.pop();var a=t.join("."),o=_dsf._obs[a]||_dsaf._obs[a];return o&&!!o[e]}))}}(),e.exports=t},function(e,n,t){"use strict";t.r(n),t.d(n,"RTCDataChannelEvent",(function(){return i})),t.d(n,"RTCConfiguration",(function(){return l})),t.d(n,"RTCPeerConnection",(function(){return r}));var a=t(0),o=t.n(a);class s{constructor(){this.bufferedAmount=0,this.label=null,this.onclose=null,this.onclosing=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.readyState=null}close(){o.a.call("async",`{"event":"DcEvent","function":"closeAppDataChannel","params":{"dcLabel":["${this.label}"]}}`,(function(e){}))}send(e){const n=btoa(String.fromCharCode.apply(null,new Uint8Array(e)));o.a.call("async",`{"event":"DcEvent","function":"sendData","params":{"dcLabel":"${this.label}","data":"${n}"}}`,(function(e){const n=JSON.parse(e);null!==this.onerror&&this.onerror(n.code)}))}getBufferedAmount(){const e=o.a.call("sync",`{"event":"DcEvent","function":"getBufferedAmount","params":{"dcLabel":"${this.label}"}}`),n=JSON.parse(e);return this.bufferedAmount=n.data.bufferedAmount,this.bufferedAmount}channelDataChannelNotify(e){switch(e){case 0:this.readyState="connecting";break;case 1:this.readyState="open",null!==this.onopen&&this.onopen(this,new Event("open"));break;case 2:this.readyState="closing",null!==this.onclosing&&this.onclosing(this,new Event("closing"));break;case 3:this.readyState="closed",null!==this.onclose&&this.onclose(this,new Event("close"))}}channelMessageNotify(e){const n=atob(e),t=new Uint8Array(n.length);for(let e=0;e<n.length;e++)t[e]=n.charCodeAt(e);if(null!==this.onmessage){const e=new MessageEvent("message",{data:t.buffer});this.onmessage(e)}}}class i{constructor(e,n){this.type=e,this.channel=n.channel,this.bubbles=!1,this.cancelable=!1}}class l{}class r{constructor(e){this.configuration=e,this.ondatachannel=null,this.channelMap=new Map,this.dataChannelNotify=e=>{const n=JSON.parse(e),t=n.dcLabel,a=n.imsDCStatus;let o=this.channelMap.get(t);if(void 0===o&&null!==this.ondatachannel){o=new s,o.label=t,this.channelMap.set(t,o);const e=new i("datachannel",{channel:o});this.ondatachannel(e)}o&&(o.channelDataChannelNotify(a),3===a&&this.channelMap.delete(t))},o.a.register("dataChannelNotify",this.dataChannelNotify),this.messageNotify=e=>{const n=JSON.parse(e),t=n.dcLabel,a=n.message;this.channelMap.get(t).channelMessageNotify(a)},o.a.register("messageNotify",this.messageNotify)}createDataChannel(e,n){let t=this.dcLabelFromXml(e),a=this.channelMap.get(t);if(void 0!==a)return a;let o=new s;return o.label=t,this.channelMap.set(t,o),this.createADC(t,e),o}close(){this.ondatachannel=null,this.channelMap.clear()}dcLabelFromXml(e){return e.split("<DcLabel>")[1].split("<\\/DcLabel>")[0]}createADC(e,n){const t=this;o.a.call("async",`{"event":"DcEvent","function":"createAppDataChannel","params":{"dcLabels":["${e}"],"DataChannelAppInfoXml":"${n}"}}`,(function(n){const a=JSON.parse(n);if("1"===a.code){const n=t.channelMap.get(e);void 0!==n&&null!==n.onerror&&n.onerror(a.code)}}))}}window.RTCPeerConnection=r,window.RTCDataChannel=s,window.RTCDataChannelEvent=i,window.RTCConfiguration=l}]).default}));